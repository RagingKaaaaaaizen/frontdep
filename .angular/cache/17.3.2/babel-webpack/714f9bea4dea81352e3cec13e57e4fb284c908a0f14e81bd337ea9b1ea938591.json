{"ast":null,"code":"import { first } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@app/_services\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nconst _c0 = (a0, a1, a2, a3) => ({\n  \"badge-success\": a0,\n  \"badge-warning\": a1,\n  \"badge-secondary\": a2,\n  \"badge-danger\": a3\n});\nconst _c1 = a0 => ({\n  \"is-invalid\": a0\n});\nfunction PCComponentsComponent_div_33_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 62);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r3.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" \", item_r3.name, \" (\", (item_r3.category == null ? null : item_r3.category.name) || \"No Category\", \") \");\n  }\n}\nfunction PCComponentsComponent_div_33_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 63);\n    i0.ɵɵtext(1, \" Please select an item \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PCComponentsComponent_div_33_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 64);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.categoryError, \" \");\n  }\n}\nfunction PCComponentsComponent_div_33_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 63);\n    i0.ɵɵtext(1, \" Quantity must be greater than 0 \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PCComponentsComponent_div_33_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 63);\n    i0.ɵɵtext(1, \" Price must be 0 or greater \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction PCComponentsComponent_div_33_span_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 65);\n  }\n}\nfunction PCComponentsComponent_div_33_i_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"i\", 66);\n  }\n}\nfunction PCComponentsComponent_div_33_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 41)(1, \"div\", 15)(2, \"div\", 16)(3, \"h6\");\n    i0.ɵɵelement(4, \"i\", 14);\n    i0.ɵɵtext(5, \" Add New Component\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 21)(7, \"form\", 42, 0);\n    i0.ɵɵlistener(\"ngSubmit\", function PCComponentsComponent_div_33_Template_form_ngSubmit_7_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.saveComponent());\n    });\n    i0.ɵɵelementStart(9, \"div\", 2)(10, \"div\", 43)(11, \"label\", 44);\n    i0.ɵɵelement(12, \"i\", 26);\n    i0.ɵɵtext(13, \" Item * \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"select\", 45);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function PCComponentsComponent_div_33_Template_select_ngModelChange_14_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newComponent.itemId, $event) || (ctx_r1.newComponent.itemId = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"change\", function PCComponentsComponent_div_33_Template_select_change_14_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onItemChange());\n    });\n    i0.ɵɵelementStart(15, \"option\", 46);\n    i0.ɵɵtext(16, \"Select Item\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(17, PCComponentsComponent_div_33_option_17_Template, 2, 3, \"option\", 47);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(18, PCComponentsComponent_div_33_div_18_Template, 2, 0, \"div\", 48)(19, PCComponentsComponent_div_33_div_19_Template, 2, 1, \"div\", 49);\n    i0.ɵɵelementStart(20, \"small\", 50);\n    i0.ɵɵelement(21, \"i\", 51);\n    i0.ɵɵtext(22, \" Only items available in stock at this location are shown. One item per category is allowed. \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"div\", 43)(24, \"label\", 44);\n    i0.ɵɵelement(25, \"i\", 28);\n    i0.ɵɵtext(26, \" Quantity * \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"input\", 52);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function PCComponentsComponent_div_33_Template_input_ngModelChange_27_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newComponent.quantity, $event) || (ctx_r1.newComponent.quantity = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"input\", function PCComponentsComponent_div_33_Template_input_input_27_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onQuantityChange());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(28, PCComponentsComponent_div_33_div_28_Template, 2, 0, \"div\", 48);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(29, \"div\", 2)(30, \"div\", 43)(31, \"label\", 44);\n    i0.ɵɵelement(32, \"i\", 29);\n    i0.ɵɵtext(33, \" Price (per item) \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"input\", 53);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function PCComponentsComponent_div_33_Template_input_ngModelChange_34_listener($event) {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r1.newComponent.price, $event) || (ctx_r1.newComponent.price = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"input\", function PCComponentsComponent_div_33_Template_input_input_34_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.calculateTotalPrice());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(35, PCComponentsComponent_div_33_div_35_Template, 2, 0, \"div\", 48);\n    i0.ɵɵelementStart(36, \"small\", 50);\n    i0.ɵɵelement(37, \"i\", 51);\n    i0.ɵɵtext(38, \" Price is automatically loaded from stock after entering quantity. \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(39, \"div\", 43)(40, \"label\", 44);\n    i0.ɵɵelement(41, \"i\", 54);\n    i0.ɵɵtext(42, \" Total Price \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(43, \"input\", 55);\n    i0.ɵɵelementStart(44, \"small\", 50);\n    i0.ɵɵtext(45, \" Automatically calculated \");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(46, \"div\", 56)(47, \"button\", 57);\n    i0.ɵɵlistener(\"click\", function PCComponentsComponent_div_33_Template_button_click_47_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.cancelAdd());\n    });\n    i0.ɵɵelement(48, \"i\", 58);\n    i0.ɵɵtext(49, \" Cancel \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"button\", 59);\n    i0.ɵɵtemplate(51, PCComponentsComponent_div_33_span_51_Template, 1, 0, \"span\", 60)(52, PCComponentsComponent_div_33_i_52_Template, 1, 0, \"i\", 61);\n    i0.ɵɵtext(53);\n    i0.ɵɵelementEnd()()()()()();\n  }\n  if (rf & 2) {\n    const componentForm_r4 = i0.ɵɵreference(8);\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(14);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newComponent.itemId);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(17, _c1, ctx_r1.submitted && !ctx_r1.newComponent.itemId));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.availableItems);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.submitted && !ctx_r1.newComponent.itemId);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.categoryError);\n    i0.ɵɵadvance(8);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newComponent.quantity);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(19, _c1, ctx_r1.submitted && (!ctx_r1.newComponent.quantity || ctx_r1.newComponent.quantity <= 0)));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.submitted && (!ctx_r1.newComponent.quantity || ctx_r1.newComponent.quantity <= 0));\n    i0.ɵɵadvance(6);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r1.newComponent.price);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(21, _c1, ctx_r1.submitted && (!ctx_r1.newComponent.price || ctx_r1.newComponent.price < 0)));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.submitted && (!ctx_r1.newComponent.price || ctx_r1.newComponent.price < 0));\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"value\", ctx_r1.newComponent.totalPrice || 0)(\"disabled\", true);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"disabled\", componentForm_r4.invalid || ctx_r1.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.loading ? \"Adding...\" : \"Add Component\", \" \");\n  }\n}\nfunction PCComponentsComponent_tr_60_small_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"small\", 82);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const component_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", component_r6.remarks, \" \");\n  }\n}\nfunction PCComponentsComponent_tr_60_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\", 67)(1, \"td\")(2, \"div\", 68)(3, \"strong\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, PCComponentsComponent_tr_60_small_5_Template, 2, 1, \"small\", 69);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"td\")(7, \"span\", 70);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"td\")(10, \"span\", 71);\n    i0.ɵɵtext(11);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"td\")(13, \"span\", 72);\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(15, \"td\")(16, \"span\", 73);\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"td\")(20, \"span\", 74);\n    i0.ɵɵtext(21);\n    i0.ɵɵpipe(22, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"td\")(24, \"div\", 75)(25, \"button\", 76);\n    i0.ɵɵlistener(\"click\", function PCComponentsComponent_tr_60_Template_button_click_25_listener() {\n      const component_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.viewComponent(component_r6.id));\n    });\n    i0.ɵɵelement(26, \"i\", 77);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"button\", 78);\n    i0.ɵɵlistener(\"click\", function PCComponentsComponent_tr_60_Template_button_click_27_listener() {\n      const component_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.editComponent(component_r6.id));\n    });\n    i0.ɵɵelement(28, \"i\", 79);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"button\", 80);\n    i0.ɵɵlistener(\"click\", function PCComponentsComponent_tr_60_Template_button_click_29_listener() {\n      const component_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.removeComponent(component_r6.id));\n    });\n    i0.ɵɵelement(30, \"i\", 81);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const component_r6 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r1.getItemName(component_r6.itemId));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", component_r6.remarks);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getCategoryName(component_r6), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.getBrandName(component_r6), \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", component_r6.quantity, \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" $\", i0.ɵɵpipeBind2(18, 7, component_r6.price, \"1.2-2\"), \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(22, 10, component_r6.createdAt, \"short\"), \" \");\n  }\n}\nfunction PCComponentsComponent_tr_61_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\", 83)(2, \"div\", 84);\n    i0.ɵɵelement(3, \"i\", 17);\n    i0.ɵɵelementStart(4, \"h4\");\n    i0.ɵɵtext(5, \"No components found\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\");\n    i0.ɵɵtext(7, \"This PC doesn't have any components yet. Click \\\"Add Component\\\" to get started.\");\n    i0.ɵɵelementEnd()()()();\n  }\n}\nexport let PCComponentsComponent = /*#__PURE__*/(() => {\n  class PCComponentsComponent {\n    constructor(route, router, pcService, stockService, itemService, categoryService, brandService, locationService, alertService) {\n      this.route = route;\n      this.router = router;\n      this.pcService = pcService;\n      this.stockService = stockService;\n      this.itemService = itemService;\n      this.categoryService = categoryService;\n      this.brandService = brandService;\n      this.locationService = locationService;\n      this.alertService = alertService;\n      this.pc = null;\n      this.components = [];\n      this.items = [];\n      this.categories = [];\n      this.brands = [];\n      this.locations = [];\n      // Add component form properties\n      this.showAddForm = false;\n      this.newComponent = {\n        itemId: null,\n        quantity: 1,\n        price: 0,\n        totalPrice: 0\n      };\n      this.availableItems = [];\n      this.allStocks = [];\n      this.existingPCComponents = [];\n      this.categoryError = '';\n      this.submitted = false;\n      this.loading = false;\n    }\n    ngOnInit() {\n      const pcId = this.route.snapshot.params['id'];\n      this.loadPC(pcId);\n      this.loadData();\n    }\n    loadData() {\n      this.loadItems();\n      this.loadCategories();\n      this.loadBrands();\n      this.loadLocations();\n      this.loadStocksForFiltering();\n    }\n    loadStocksForFiltering() {\n      this.stockService.getAll().pipe(first()).subscribe({\n        next: stocks => {\n          this.allStocks = stocks;\n          this.filterAvailableItems();\n        },\n        error: error => {\n          this.alertService.error('Error loading stocks: ' + error);\n        }\n      });\n    }\n    filterAvailableItems() {\n      if (!this.pc) return;\n      // Get all stock entries for the PC's location\n      const locationStocks = this.allStocks.filter(stock => stock.locationId === this.pc.roomLocationId && !stock.remarks?.includes('PC:') // Exclude items already assigned to PCs\n      );\n      // Group by item and calculate available quantities\n      const itemAvailability = new Map();\n      locationStocks.forEach(stock => {\n        const itemId = stock.itemId;\n        if (!itemAvailability.has(itemId)) {\n          itemAvailability.set(itemId, 0);\n        }\n        itemAvailability.set(itemId, itemAvailability.get(itemId) + stock.quantity);\n      });\n      // Filter items that have stock available\n      this.availableItems = this.items.filter(item => {\n        const availableQty = itemAvailability.get(item.id) || 0;\n        return availableQty > 0;\n      });\n      console.log('Available items for PC component:', this.availableItems);\n    }\n    loadExistingPCComponents() {\n      if (!this.pc) return;\n      // Get existing components for this PC\n      this.existingPCComponents = this.allStocks.filter(stock => stock.locationId === this.pc.roomLocationId && stock.remarks && stock.remarks.includes(`PC: ${this.pc.name}`));\n      console.log('Existing PC components:', this.existingPCComponents);\n    }\n    onItemChange() {\n      if (this.newComponent.itemId) {\n        this.validateCategory();\n      }\n    }\n    onQuantityChange() {\n      if (this.newComponent.itemId && this.newComponent.quantity) {\n        this.loadPriceFromStock();\n      }\n    }\n    loadPriceFromStock() {\n      if (!this.newComponent.itemId || !this.newComponent.quantity) return;\n      // Find all stock entries for this item at the PC's location (excluding PC components)\n      const stockEntries = this.allStocks.filter(stock => stock.itemId === this.newComponent.itemId && stock.locationId === this.pc.roomLocationId && !stock.remarks?.includes('PC:'));\n      if (stockEntries.length > 0) {\n        // Check if we have enough quantity in stock\n        const totalAvailableQuantity = stockEntries.reduce((total, stock) => total + stock.quantity, 0);\n        if (this.newComponent.quantity > totalAvailableQuantity) {\n          console.log('Requested quantity exceeds available stock');\n          return;\n        }\n        // Sort by creation date (most recent first)\n        stockEntries.sort((a, b) => {\n          const dateA = new Date(a.createdAt || 0);\n          const dateB = new Date(b.createdAt || 0);\n          return dateB.getTime() - dateA.getTime(); // Most recent first\n        });\n        // Find the specific stock entry that can fulfill this exact quantity\n        let remainingQuantity = this.newComponent.quantity;\n        let selectedStock = null;\n        for (const stock of stockEntries) {\n          if (stock.quantity >= remainingQuantity) {\n            selectedStock = stock;\n            break;\n          }\n          remainingQuantity -= stock.quantity;\n        }\n        if (selectedStock) {\n          // Use the price from this specific stock entry\n          this.newComponent.price = selectedStock.price;\n          this.calculateTotalPrice();\n          console.log('Price loaded from specific stock entry:', {\n            stockId: selectedStock.id,\n            stockQuantity: selectedStock.quantity,\n            stockPrice: selectedStock.price,\n            requestedQuantity: this.newComponent.quantity,\n            priceUsed: selectedStock.price\n          });\n        } else {\n          console.log('No single stock entry can fulfill the requested quantity');\n          // Use the most recent stock entry's price as fallback\n          const mostRecentStock = stockEntries[0];\n          this.newComponent.price = mostRecentStock.price;\n          this.calculateTotalPrice();\n          console.log('Using fallback price from most recent stock entry:', mostRecentStock.price);\n        }\n      }\n    }\n    validateCategory() {\n      if (!this.newComponent.itemId) return;\n      const selectedItem = this.items.find(item => item.id === this.newComponent.itemId);\n      if (!selectedItem) return;\n      const selectedCategoryId = selectedItem.categoryId;\n      // Check if this category is already used in existing components\n      const categoryAlreadyUsed = this.existingPCComponents.some(component => {\n        const componentItem = this.items.find(item => item.id === component.itemId);\n        return componentItem && componentItem.categoryId === selectedCategoryId;\n      });\n      if (categoryAlreadyUsed) {\n        this.categoryError = `Category \"${selectedItem.category?.name || 'Unknown'}\" is already used in this PC. Only one item per category is allowed.`;\n        this.newComponent.itemId = null; // Reset selection\n      } else {\n        this.categoryError = '';\n      }\n    }\n    calculateTotalPrice() {\n      const price = this.newComponent.price ?? 0;\n      const qty = this.newComponent.quantity ?? 0;\n      this.newComponent.totalPrice = price * qty;\n    }\n    loadPC(pcId) {\n      this.pcService.getById(pcId).pipe(first()).subscribe({\n        next: pc => {\n          this.pc = pc;\n          this.loadComponents(pcId);\n          this.loadExistingPCComponents();\n          this.filterAvailableItems();\n        },\n        error: error => {\n          this.alertService.error('Error loading PC: ' + error);\n        }\n      });\n    }\n    loadComponents(pcId) {\n      // Load stock entries that are associated with this PC\n      this.stockService.getAll().pipe(first()).subscribe({\n        next: stocks => {\n          // Filter stocks that are associated with this PC (by location and remarks)\n          this.components = stocks.filter(stock => stock.locationId === this.pc.roomLocationId && stock.remarks && stock.remarks.includes(`PC: ${this.pc.name}`));\n        },\n        error: error => {\n          this.alertService.error('Error loading components: ' + error);\n        }\n      });\n    }\n    loadItems() {\n      this.itemService.getAll().pipe(first()).subscribe({\n        next: items => {\n          this.items = items;\n        },\n        error: error => {\n          this.alertService.error('Error loading items: ' + error);\n        }\n      });\n    }\n    loadCategories() {\n      this.categoryService.getAll().pipe(first()).subscribe({\n        next: categories => {\n          this.categories = categories;\n        },\n        error: error => {\n          this.alertService.error('Error loading categories: ' + error);\n        }\n      });\n    }\n    loadBrands() {\n      this.brandService.getAll().pipe(first()).subscribe({\n        next: brands => {\n          this.brands = brands;\n        },\n        error: error => {\n          this.alertService.error('Error loading brands: ' + error);\n        }\n      });\n    }\n    loadLocations() {\n      this.locationService.getAll().pipe(first()).subscribe({\n        next: locations => {\n          this.locations = locations;\n        },\n        error: error => {\n          this.alertService.error('Error loading locations: ' + error);\n        }\n      });\n    }\n    refreshData() {\n      this.loadComponents(this.pc.id);\n      this.alertService.success('Data refreshed successfully');\n    }\n    getItemName(itemId) {\n      const item = this.items.find(i => i.id === itemId);\n      return item ? item.name : 'Unknown Item';\n    }\n    getCategoryName(component) {\n      const item = this.items.find(i => i.id === component.itemId);\n      if (!item) return 'Unknown';\n      const category = this.categories.find(c => c.id === item.categoryId);\n      return category ? category.name : 'Unknown Category';\n    }\n    getBrandName(component) {\n      const item = this.items.find(i => i.id === component.itemId);\n      if (!item) return 'Unknown';\n      const brand = this.brands.find(b => b.id === item.brandId);\n      return brand ? brand.name : 'Unknown Brand';\n    }\n    getLocationName(locationId) {\n      const location = this.locations.find(l => l.id === locationId);\n      return location ? location.name : 'Unknown Location';\n    }\n    getTotalValue() {\n      return this.components.reduce((total, component) => {\n        return total + component.price * component.quantity;\n      }, 0);\n    }\n    getUniqueCategories() {\n      const categoryIds = this.components.map(component => {\n        const item = this.items.find(i => i.id === component.itemId);\n        return item ? item.categoryId : null;\n      }).filter(id => id !== null);\n      return [...new Set(categoryIds)].length;\n    }\n    getTotalQuantity() {\n      return this.components.reduce((total, component) => {\n        return total + component.quantity;\n      }, 0);\n    }\n    addComponent() {\n      this.showAddForm = true;\n      this.resetNewComponent();\n      this.loadExistingPCComponents();\n    }\n    cancelAdd() {\n      this.showAddForm = false;\n      this.resetNewComponent();\n      this.categoryError = '';\n      this.submitted = false;\n    }\n    resetNewComponent() {\n      this.newComponent = {\n        itemId: null,\n        quantity: 1,\n        price: 0,\n        totalPrice: 0\n      };\n    }\n    saveComponent() {\n      this.submitted = true;\n      // Validate required fields\n      if (!this.newComponent.itemId) {\n        this.alertService.error('Please select an item');\n        return;\n      }\n      if (!this.newComponent.quantity || this.newComponent.quantity <= 0) {\n        this.alertService.error('Quantity must be greater than 0');\n        return;\n      }\n      if (!this.newComponent.price || this.newComponent.price < 0) {\n        this.alertService.error('Price must be 0 or greater');\n        return;\n      }\n      // Additional validation for PC components\n      if (this.categoryError) {\n        this.alertService.error(this.categoryError);\n        return;\n      }\n      // Check if selected quantity is available in stock\n      const selectedItem = this.items.find(item => item.id === this.newComponent.itemId);\n      const availableStocks = this.allStocks.filter(stock => stock.itemId === this.newComponent.itemId && stock.locationId === this.pc.roomLocationId && !stock.remarks?.includes('PC:'));\n      const availableQuantity = availableStocks.reduce((total, stock) => total + stock.quantity, 0);\n      if (this.newComponent.quantity > availableQuantity) {\n        this.alertService.error(`Only ${availableQuantity} units of \"${selectedItem?.name}\" are available in stock.`);\n        return;\n      }\n      // Auto-calculate before saving\n      this.calculateTotalPrice();\n      this.loading = true;\n      // Create stock entry for PC component\n      const stockData = {\n        itemId: this.newComponent.itemId,\n        quantity: this.newComponent.quantity,\n        price: this.newComponent.price,\n        totalPrice: this.newComponent.totalPrice,\n        locationId: this.pc.roomLocationId,\n        remarks: `PC: ${this.pc.name}`\n      };\n      this.stockService.create(stockData).pipe(first()).subscribe({\n        next: result => {\n          this.loading = false;\n          this.alertService.success('Component added successfully');\n          this.showAddForm = false;\n          this.resetNewComponent();\n          this.categoryError = '';\n          this.submitted = false;\n          this.loadComponents(this.pc.id);\n        },\n        error: error => {\n          this.loading = false;\n          this.alertService.error('Error adding component: ' + error);\n        }\n      });\n    }\n    viewComponent(id) {\n      this.router.navigate(['/stocks', id]);\n    }\n    editComponent(id) {\n      this.router.navigate(['/stocks', id, 'edit']);\n    }\n    removeComponent(id) {\n      if (confirm('Are you sure you want to remove this component from the PC?')) {\n        this.stockService.delete(id).pipe(first()).subscribe({\n          next: () => {\n            this.alertService.success('Component removed successfully');\n            this.loadComponents(this.pc.id);\n          },\n          error: error => {\n            this.alertService.error('Error removing component: ' + error);\n          }\n        });\n      }\n    }\n    static #_ = this.ɵfac = function PCComponentsComponent_Factory(t) {\n      return new (t || PCComponentsComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.PCService), i0.ɵɵdirectiveInject(i2.StockService), i0.ɵɵdirectiveInject(i2.ItemService), i0.ɵɵdirectiveInject(i2.CategoryService), i0.ɵɵdirectiveInject(i2.BrandService), i0.ɵɵdirectiveInject(i2.StorageLocationService), i0.ɵɵdirectiveInject(i2.AlertService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: PCComponentsComponent,\n      selectors: [[\"app-pc-components\"]],\n      decls: 96,\n      vars: 20,\n      consts: [[\"componentForm\", \"ngForm\"], [1, \"container\"], [1, \"row\"], [1, \"col-12\"], [1, \"pc-header\", \"mb-4\"], [1, \"d-flex\", \"justify-content-between\", \"align-items-center\"], [1, \"fas\", \"fa-desktop\"], [1, \"text-muted\", \"mb-0\"], [1, \"fas\", \"fa-map-marker-alt\"], [1, \"fas\", \"fa-barcode\"], [1, \"badge\", 3, \"ngClass\"], [\"routerLink\", \"/pc\", 1, \"btn\", \"btn-secondary\"], [1, \"fas\", \"fa-arrow-left\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"ml-2\", 3, \"click\"], [1, \"fas\", \"fa-plus\"], [1, \"card\"], [1, \"card-header\"], [1, \"fas\", \"fa-microchip\"], [1, \"header-actions\"], [1, \"btn\", \"btn-sm\", \"btn-outline-secondary\", 3, \"click\"], [1, \"fas\", \"fa-sync-alt\"], [1, \"card-body\"], [\"class\", \"add-component-form mb-4\", 4, \"ngIf\"], [1, \"table-responsive\"], [1, \"table\", \"table-hover\"], [1, \"fas\", \"fa-box\"], [1, \"fas\", \"fa-tag\"], [1, \"fas\", \"fa-trademark\"], [1, \"fas\", \"fa-sort-numeric-up\"], [1, \"fas\", \"fa-dollar-sign\"], [1, \"fas\", \"fa-calendar\"], [1, \"fas\", \"fa-cogs\"], [\"class\", \"component-row\", 4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [1, \"row\", \"mt-4\"], [1, \"col-md-3\"], [1, \"stat-card\"], [1, \"stat-icon\"], [1, \"stat-number\"], [1, \"stat-label\"], [1, \"fas\", \"fa-tags\"], [1, \"add-component-form\", \"mb-4\"], [3, \"ngSubmit\"], [1, \"form-group\", \"col-md-6\"], [1, \"form-label\"], [\"name\", \"itemId\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"change\", \"ngModel\", \"ngClass\"], [\"value\", \"\", \"disabled\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"invalid-feedback\", 4, \"ngIf\"], [\"class\", \"invalid-feedback d-block\", 4, \"ngIf\"], [1, \"form-text\", \"text-muted\"], [1, \"fas\", \"fa-info-circle\"], [\"type\", \"number\", \"name\", \"quantity\", \"required\", \"\", \"placeholder\", \"Enter quantity\", 1, \"form-control\", 3, \"ngModelChange\", \"input\", \"ngModel\", \"ngClass\"], [\"type\", \"number\", \"name\", \"price\", \"step\", \"0.01\", \"required\", \"\", \"placeholder\", \"Enter price\", 1, \"form-control\", 3, \"ngModelChange\", \"input\", \"ngModel\", \"ngClass\"], [1, \"fas\", \"fa-calculator\"], [\"type\", \"number\", \"readonly\", \"\", 1, \"form-control\", 3, \"value\", \"disabled\"], [1, \"form-actions\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-secondary\", 3, \"click\"], [1, \"fas\", \"fa-times\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [\"class\", \"spinner-border spinner-border-sm me-2\", 4, \"ngIf\"], [\"class\", \"fas fa-save me-2\", 4, \"ngIf\"], [3, \"value\"], [1, \"invalid-feedback\"], [1, \"invalid-feedback\", \"d-block\"], [1, \"spinner-border\", \"spinner-border-sm\", \"me-2\"], [1, \"fas\", \"fa-save\", \"me-2\"], [1, \"component-row\"], [1, \"item-info\"], [\"class\", \"d-block text-muted\", 4, \"ngIf\"], [1, \"category-badge\"], [1, \"brand-badge\"], [1, \"quantity-badge\"], [1, \"price-value\"], [1, \"date-value\"], [1, \"action-buttons\"], [\"type\", \"button\", \"title\", \"View Details\", 1, \"btn\", \"btn-sm\", \"btn-outline-primary\", 3, \"click\"], [1, \"fas\", \"fa-eye\"], [\"type\", \"button\", \"title\", \"Edit Component\", 1, \"btn\", \"btn-sm\", \"btn-outline-warning\", 3, \"click\"], [1, \"fas\", \"fa-edit\"], [\"type\", \"button\", \"title\", \"Remove Component\", 1, \"btn\", \"btn-sm\", \"btn-outline-danger\", 3, \"click\"], [1, \"fas\", \"fa-trash\"], [1, \"d-block\", \"text-muted\"], [\"colspan\", \"7\", 1, \"text-center\", \"py-4\"], [1, \"empty-state\"]],\n      template: function PCComponentsComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\", 3)(3, \"div\", 4)(4, \"div\", 5)(5, \"div\")(6, \"h2\");\n          i0.ɵɵelement(7, \"i\", 6);\n          i0.ɵɵtext(8);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"p\", 7);\n          i0.ɵɵelement(10, \"i\", 8);\n          i0.ɵɵtext(11);\n          i0.ɵɵelement(12, \"i\", 9);\n          i0.ɵɵtext(13);\n          i0.ɵɵelementStart(14, \"span\", 10);\n          i0.ɵɵtext(15);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(16, \"div\")(17, \"a\", 11);\n          i0.ɵɵelement(18, \"i\", 12);\n          i0.ɵɵtext(19, \" Back to PCs \");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"button\", 13);\n          i0.ɵɵlistener(\"click\", function PCComponentsComponent_Template_button_click_20_listener() {\n            return ctx.addComponent();\n          });\n          i0.ɵɵelement(21, \"i\", 14);\n          i0.ɵɵtext(22, \" Add Component \");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(23, \"div\", 15)(24, \"div\", 16)(25, \"h5\");\n          i0.ɵɵelement(26, \"i\", 17);\n          i0.ɵɵtext(27, \" PC Components\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"div\", 18)(29, \"button\", 19);\n          i0.ɵɵlistener(\"click\", function PCComponentsComponent_Template_button_click_29_listener() {\n            return ctx.refreshData();\n          });\n          i0.ɵɵelement(30, \"i\", 20);\n          i0.ɵɵtext(31, \" Refresh \");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(32, \"div\", 21);\n          i0.ɵɵtemplate(33, PCComponentsComponent_div_33_Template, 54, 23, \"div\", 22);\n          i0.ɵɵelementStart(34, \"div\", 23)(35, \"table\", 24)(36, \"thead\")(37, \"tr\")(38, \"th\");\n          i0.ɵɵelement(39, \"i\", 25);\n          i0.ɵɵtext(40, \" Item\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(41, \"th\");\n          i0.ɵɵelement(42, \"i\", 26);\n          i0.ɵɵtext(43, \" Category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(44, \"th\");\n          i0.ɵɵelement(45, \"i\", 27);\n          i0.ɵɵtext(46, \" Brand\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(47, \"th\");\n          i0.ɵɵelement(48, \"i\", 28);\n          i0.ɵɵtext(49, \" Quantity\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(50, \"th\");\n          i0.ɵɵelement(51, \"i\", 29);\n          i0.ɵɵtext(52, \" Price\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(53, \"th\");\n          i0.ɵɵelement(54, \"i\", 30);\n          i0.ɵɵtext(55, \" Added Date\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(56, \"th\");\n          i0.ɵɵelement(57, \"i\", 31);\n          i0.ɵɵtext(58, \" Actions\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(59, \"tbody\");\n          i0.ɵɵtemplate(60, PCComponentsComponent_tr_60_Template, 31, 13, \"tr\", 32)(61, PCComponentsComponent_tr_61_Template, 8, 0, \"tr\", 33);\n          i0.ɵɵelementEnd()()()()();\n          i0.ɵɵelementStart(62, \"div\", 34)(63, \"div\", 35)(64, \"div\", 36)(65, \"div\", 37);\n          i0.ɵɵelement(66, \"i\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(67, \"div\", 38);\n          i0.ɵɵtext(68);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(69, \"div\", 39);\n          i0.ɵɵtext(70, \"Total Components\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(71, \"div\", 35)(72, \"div\", 36)(73, \"div\", 37);\n          i0.ɵɵelement(74, \"i\", 29);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(75, \"div\", 38);\n          i0.ɵɵtext(76);\n          i0.ɵɵpipe(77, \"number\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(78, \"div\", 39);\n          i0.ɵɵtext(79, \"Total Value\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(80, \"div\", 35)(81, \"div\", 36)(82, \"div\", 37);\n          i0.ɵɵelement(83, \"i\", 40);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(84, \"div\", 38);\n          i0.ɵɵtext(85);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(86, \"div\", 39);\n          i0.ɵɵtext(87, \"Categories\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(88, \"div\", 35)(89, \"div\", 36)(90, \"div\", 37);\n          i0.ɵɵelement(91, \"i\", 28);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(92, \"div\", 38);\n          i0.ɵɵtext(93);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(94, \"div\", 39);\n          i0.ɵɵtext(95, \"Total Items\");\n          i0.ɵɵelementEnd()()()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵtextInterpolate1(\" \", ctx.pc == null ? null : ctx.pc.name, \"\");\n          i0.ɵɵadvance(3);\n          i0.ɵɵtextInterpolate1(\" \", ctx.getLocationName(ctx.pc == null ? null : ctx.pc.roomLocationId), \" | \");\n          i0.ɵɵadvance(2);\n          i0.ɵɵtextInterpolate1(\" \", (ctx.pc == null ? null : ctx.pc.serialNumber) || \"No Serial\", \" | \");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction4(15, _c0, (ctx.pc == null ? null : ctx.pc.status) === \"Active\", (ctx.pc == null ? null : ctx.pc.status) === \"Maintenance\", (ctx.pc == null ? null : ctx.pc.status) === \"Inactive\", (ctx.pc == null ? null : ctx.pc.status) === \"Retired\"));\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate(ctx.pc == null ? null : ctx.pc.status);\n          i0.ɵɵadvance(18);\n          i0.ɵɵproperty(\"ngIf\", ctx.showAddForm);\n          i0.ɵɵadvance(27);\n          i0.ɵɵproperty(\"ngForOf\", ctx.components);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.components.length === 0);\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate(ctx.components.length);\n          i0.ɵɵadvance(8);\n          i0.ɵɵtextInterpolate1(\"$\", i0.ɵɵpipeBind2(77, 12, ctx.getTotalValue(), \"1.0-0\"), \"\");\n          i0.ɵɵadvance(9);\n          i0.ɵɵtextInterpolate(ctx.getUniqueCategories());\n          i0.ɵɵadvance(8);\n          i0.ɵɵtextInterpolate(ctx.getTotalQuantity());\n        }\n      },\n      dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.RequiredValidator, i4.NgModel, i4.NgForm, i1.RouterLink, i3.DecimalPipe, i3.DatePipe],\n      styles: [\".pc-header[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 10px #0000001a}.card[_ngcontent-%COMP%]{border:none;border-radius:12px;box-shadow:0 2px 10px #0000001a;margin-bottom:20px}.card-header[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:12px 12px 0 0!important;padding:20px;font-weight:600;display:flex;justify-content:space-between;align-items:center}.component-row[_ngcontent-%COMP%]{transition:all .3s ease}.component-row[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;transform:scale(1.01)}.item-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.category-badge[_ngcontent-%COMP%], .brand-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:12px;font-size:.8rem;font-weight:500;background:#667eea1a;color:#667eea}.quantity-badge[_ngcontent-%COMP%]{padding:6px 12px;border-radius:20px;font-size:.9rem;font-weight:600;background:#28a7451a;color:#28a745}.price-value[_ngcontent-%COMP%]{font-weight:600;color:#333}.date-value[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:5px;flex-wrap:wrap}.action-buttons[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:6px 10px;font-size:.8rem}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px;color:#666}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:4rem;color:#ddd;margin-bottom:20px}.empty-state[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#333;margin-bottom:10px}.stat-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:25px;box-shadow:0 2px 10px #0000001a;transition:all .3s ease;text-align:center}.stat-card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 8px 25px #00000026}.stat-icon[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:15px;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.stat-number[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#333;margin-bottom:5px}.stat-label[_ngcontent-%COMP%]{color:#666;font-size:1rem}\"]\n    });\n  }\n  return PCComponentsComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}